# -----------------------------------------------------------------------------
#
# (c) 2011 Tsitsimpis Ilias
#
# This file is part of the GAC build system.
#
# To understand how the build system works and how to modify it, see HACKING
#
# -----------------------------------------------------------------------------


PREFIX  = @prefix@
TAR     = @TarCmd@

VERSION = @PACKAGE_VERSION@
PACKAGE = @PACKAGE_TARNAME@
ARCHIVE = $(PACKAGE)-$(VERSION)

.PHONY: all
all:
	$(MAKE) -C src $@

.PHONY: install
install:
	$(MAKE) -C src $@

.PHONY: dist
dist:
	@echo "Cleaning all the generated files.."
	$(MAKE) maintainer-clean
	$(RM) -r $(ARCHIVE)
	$(RM) $(ARCHIVE).tar.gz
	@echo "Copying files.."
	mkdir $(ARCHIVE)
	$(TAR) cf - --exclude=$(ARCHIVE) --exclude-vcs * | \
		(cd $(ARCHIVE) && tar xf -)
	@echo "Generating archive.."
	$(TAR) zcf $(ARCHIVE).tar.gz $(ARCHIVE)
	@echo "Cleaning temp files.."
	$(RM) -r $(ARCHIVE)

.PHONY: distcheck
distcheck: dist
	@echo "Unpacking the tar.."
	tar xzf $(ARCHIVE).tar.gz
	@echo "Configuring the dist package.."
	(cd $(ARCHIVE) && ./configure)
	@echo "Compiling the dist package.."
	$(MAKE) -C $(ARCHIVE)
	@echo "Testing the dist package.."
	$(MAKE) -C $(ARCHIVE) test
	@echo "Cleaning temp files.."
	$(RM) -r $(ARCHIVE)

.PHONY: clean
clean:
	$(MAKE) -C src $@

.PHONY: distclean
distclean: clean
	$(RM) Makefile src/Makefile src/config.h src/gac.cabal src/versions.h
	$(RM) config.log config.status

.PHONY: maintainer-clean
maintainer-clean: distclean
	$(RM) -r autom4te.cache

.PHONY: test
test:
	@echo "Coming soon.."
